(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{982:function(e,t,a){"use strict";a.r(t);var n=a(0),m=a.n(n),f=a(5),p=a(665),o=(a(749),a(29)),r=a(9),h=a(70),g=a(93),s=a(10),i=a(7),l=a(1),n=(a(83),a(666)),c=a.n(n),u=a(929),d=a(945),E=a(931),b=a(955);a(974);function v(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(a);(n="function"==typeof Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})):n).forEach(function(e){y(t,e,a[e])})}return t}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function w(e){var a=e.datasets,n=e.labels,r=e.onDrilldownRequested,i=e.pivotConfig;return m.a.useCallback(function(e){var t;e.length<=0||(e=(t=e[0]).datasetIndex,t=t.index,e=a[e].yValues,t=[n[t]],"function"==typeof r&&r({xValues:t,yValues:e},i))},[a,n,r])}function S(e){return m.a.createElement(u.a,{query:{measures:["WifeositeEventCollection.count"],timeDimensions:[],order:[["WifeositeEventCollection.count","desc"],["WifeositeEventCollection.eventName","asc"]],dimensions:["WifeositeEventCollection.eventName","WifeositeEventCollection.siteUid"],filters:[{member:"WifeositeEventCollection.funnelhash",operator:"equals",values:[e.funnelHash.toString()]}]},cubejsApi:function(e){var t=Object(s.g)("https://awbjanv94g.execute-api.eu-west-1.amazonaws.com/prod/platform").replace(/\/+$/,""),a=e.siteId,n=Object(s.v)(localStorage.getItem("currentUser")),e=!0;if((e=n&&Date.now()/1e3<n.exp?!1:e)&&localStorage.removeItem("statsUser"),localStorage.getItem("statsUser"))return c()(localStorage.getItem("statsUser"),{apiUrl:"https://stats.wifeosite.com/cubejs-api/v1"});fetch(t+"/api/stats/"+a+"/tokens/mes",{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("currentUser")}}).then(function(e){return e.json()}).then(function(e){return localStorage.setItem("statsUser",e),c()(localStorage.getItem("statsUser"),{apiUrl:"https://stats.wifeosite.com/cubejs-api/v1"})})}(e),resetResultSetOnChange:!1,render:function(e){return t=v({},e,{chartType:"bar",pivotConfig:{x:["WifeositeEventCollection.eventName","WifeositeEventCollection.siteUid"],y:["measures"],fillMissingDates:!0,joinDateRange:!1}}),a=t.resultSet,e=t.error,t=t.pivotConfig,e?m.a.createElement("div",null,e.toString()):a?m.a.createElement(C,{resultSet:a,pivotConfig:t}):m.a.createElement(d.a,null);var t,a}})}var O=["#5b8ff9","#5ad8a6","#5e7092","#f6bd18","#6f5efa","#6ec8ec","#945fb9","#ff9845","#299796","#fe99c3"],I={maintainAspectRatio:!1,interaction:{intersect:!1},plugins:{legend:{position:"bottom"}},scales:{x:{ticks:{autoSkip:!0,maxRotation:0,padding:12,minRotation:0}}}},C=function(e){var t=e.resultSet,a=e.pivotConfig,n=e.onDrilldownRequested,r=Object(b.a)(function(){return t.series().map(function(e,t){t={label:"Funnel",data:e.series.map(function(e){return e.value}),yValues:[e.key],backgroundColor:O[t],fill:!1};return e.key,t})},[t]),i=1,e={labels:t.categories().map(function(e){return"Etape "+i++}),datasets:r},r=!(a.x||[]).includes("measures"),r=v({},I,{scales:{x:v({},I.scales.x,{stacked:r}),y:v({},I.scales.y,{stacked:r})}}),a=w({datasets:e.datasets,labels:e.labels,onDrilldownRequested:n,pivotConfig:a});return m.a.createElement(E.Bar,{type:"bar",data:e,options:r,getElementAtEvent:a})};function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t,a,n,r,i,o){try{var s=e[i](o),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(n,r)}function P(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(a);(n="function"==typeof Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})):n).forEach(function(e){_(t,e,a[e])})}return t}function k(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(a){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=T(a);return e=n?(e=T(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==j(e)&&"function"!=typeof e?D(t):e}}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function L(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?A(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function R(e){var t=e.showModal,a=e.hideModal,n=e.confirmModal,r=e.id,i=e.type;return e.message,m.a.createElement(f.Modal,{centered:!0,dialogClassName:" small-modal-w we-m-auto",show:t,onHide:a},m.a.createElement(f.Modal.Header,{closeButton:!0},m.a.createElement(f.Modal.Title,null," Attention !")),m.a.createElement(f.Modal.Body,null,m.a.createElement("div",{className:"we-container we-pt-4"},"Voulez-vous vraiment supprimer ce ",i,"?")),m.a.createElement(f.Modal.Footer,null,m.a.createElement(f.Button,{variant:"secondary",onClick:a,size:"sm"},"Annuler"),m.a.createElement(f.Button,{variant:"danger",size:"sm",onClick:function(){return n(i,r)}},"Supprimer")))}var B={headers:{Accept:"application/json","Content-Type":"application/json",Authorization:localStorage.getItem("currentUser")?"Bearer "+localStorage.getItem("currentUser"):""}},a=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(r,m.a.Component);var e,t,a,n=x(r);function r(){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),_(D(i=n.call(this)),"generateItems",function(e,t){var a=[],n=i.state.totalPages,r=0;return Array.isArray(e)&&e.forEach(function(e){e.is_cours&&n++,a.push(t(r,e)),r++}),0<n&&i.setState({totalPages:n}),a}),_(D(i),"compareOrdre",function(e,t){return e.metadata.ordre<t.metadata.ordre?-1:e.metadata.ordre>t.metadata.ordre?1:0}),_(D(i),"buildTreeview",function(e){root.id;e={type:"container",props:{orientation:"vertical"},children:i.generateItems(e,function(e,t){return{id:t.id,type:"container",metadata:t,props:{orientation:"vertical",className:"we-card-container"},children:[]}}).sort(i.compareOrdre)};i.setState({scene:P({},e),treeRootId:i.props.match.params.menu_id,isLoading:!1})}),_(D(i),"onColumnDrop",function(e){var t=P({},i.state.scene);t.children=function(e,t){var a=t.removedIndex,n=t.addedIndex,t=t.payload;if(null===a&&null===n)return e;e=L(e);return null!==a&&(t=e.splice(a,1)[0]),null!==n&&e.splice(n,0,t),e}(t.children,e);var a=[],n=0;t.children.forEach(function(e){a.push({id:e.id,rank:n}),n++}),i.saveOrder(a,function(){i.setState({scene:t,isLoading:!1})})}),_(D(i),"resetCurrentItem",function(){i.setState({currentItemInEdit:{metadata:{id:0}}})}),_(D(i),"edit",function(e){e==i.state.currentItemInEdit?i.resetCurrentItem():i.setState({currentItemInEdit:e})}),_(D(i),"addEtape",function(){var e;i.state.isLoading||(i.state.treeRootId.toString(),i.setState({isLoading:!0}),e={nom:e="Landing "+(e=(e=(new Date).getTime().toString(6)).substring(e.length-7,e.length)),url:Object(s.y)(e),editor:"10",is_home:!1,is_error:!1,layout:null,module:6,module_page_type:"funnel"},Object(o.h)().apiSitesSitePagesPost(e,i.props.currentSiteInEdit.id,B).call().then(function(e){e={title:e.nom,target:null,visible:!0,url:e.url,type:"page",page:e.id,parent:null};Object(o.c)().apiMenusSlugItemsPost(e,i.props.match.params.menu_id,B).call().then(function(e){var e={id:e.id,type:"we-container",metadata:e,props:{orientation:"vertical",className:"we-card-container"},children:[]},t=Object.assign({},i.state.scene),a=(t.children.push(e),[]),n=0;t.children.forEach(function(e){a.push({id:e.id,rank:n}),n++}),i.saveOrder(a,function(){i.setState({scene:t,isLoading:!1})})})}))}),_(D(i),"deleteEtape",function(){var e=i.state.EtapeToDelete,t=e.Etape,a=e.index;Object(o.c)().apiMenusSlugItemsMenuDelete(i.props.match.params.menu_id,t.metadata.id,B).call().then(function(e){Object(o.f)().apiPagesPageDelete(t.metadata.page.id,B).call().then(function(e){var t=Object.assign({},i.state.scene);t.children.splice(a,1),i.setState({isLoading:!1,displayConfirmationModal:!1,scene:t})})})}),_(D(i),"deleteIntent",function(e,t,a){i.setState({itemToDelete:{item:e,Etape:t,index:a},displayConfirmationModal:!0},function(){})}),_(D(i),"deleteEtapeIntent",function(e,t){i.setState({EtapeToDelete:{Etape:e,index:t},displayConfirmationModal:!0},function(){})}),_(D(i),"goToMainPage",function(){location.href="/editor/pages/formation/"+window.__METADATA.product_props.id}),_(D(i),"goToPage",function(e){location.href="/editor/funnel/"+i.props.match.params.menu_id+"/pages/"+e.metadata.page.id}),_(D(i),"dragStart",function(e){i.setState({isLoading:!0,currentPayload:e.payload})}),_(D(i),"dragEnd",function(e){}),_(D(i),"saveOrder",function(e,t){Object(o.c)().apiMenusSlugItemOrderPut(e,i.props.match.params.menu_id,B).call().then(function(e){t()})}),_(D(i),"saveEtape",function(n){i.state.isLoading||(i.setState({isLoading:!0}),Object(o.c)().apiMenusSlugItemsMenuItemPatchPut({name:n.name},i.props.match.params.menu_id,n.id,B).call().then(function(e){var t=Object.assign({},i.state.scene),a=t.children.map(function(e){return e.id===n.id?n:e});i.setState({scene:{scene:t,children:a},forcedReloadCount:i.state.forcedReloadCount+1},function(){i.setState({isLoading:!1,currentItemInEdit:{metadata:{id:0}}})})}))}),_(D(i),"hasDraft",function(){}),_(D(i),"getCardPayload",function(t){return function(e){return i.state.scene.children.filter(function(e){return e.id===t})[0].children[e]}}),i.state={isCursusLoaded:!1,currentItemInEdit:{metadata:{id:0}},currentPayload:{},itemToDelete:{item:{},Etape:{},index:0},EtapeToDelete:{Etape:{},index:0},treeRootId:0,productId:0,isLoading:!1,totalPages:0,maxPages:100,formationId:"0",produit:{titre:""},cursusTree:[],displayConfirmationModal:!1,forcedReloadCount:0,sectionSommaireId:0,scene:{type:"container",props:{orientation:"vertical"},children:[]}},i.dragStart=i.dragStart.bind(D(i)),i.deleteCursus=i.deleteCursus.bind(D(i)),i}return e=r,(t=[{key:"componentDidUpdate",value:function(){var t=this;this.state.isCursusLoaded||Object(o.c)().apiMenusSlugItemsGet(this.props.match.params.menu_id,1,null,B).call().then(function(e){e.items&&0<e.items.length&&(t.buildTreeview(e.items),t.setState({isCursusLoaded:!0}))})}},{key:"componentDidMount",value:function(){var t=this;this.state.isCursusLoaded||Object(o.c)().apiMenusSlugItemsGet(this.props.match.params.menu_id,1,null,B).call().then(function(e){e.items&&0<e.items.length&&(t.buildTreeview(e.items),t.setState({isCursusLoaded:!0}))})}},{key:"deleteCursus",value:function(){this.state.isLoading||(this.setState({isLoading:!0}),this.deleteEtape())}},{key:"render",value:function(){var e=this,t=this.state,a=t.currentItemInEdit,n=(t.totalPages,t.maxPages,t.scene),r=this.props.currentPageInEdit&&this.props.currentPageInEdit.id,i=(this.dragStart,this.dragEnd,this.onColumnDrop,this.deleteEtape,this.deleteEtapeIntent),o=(this.deleteIntent,this.getCardPayload,this.edit),s=this.goToPage,l=(this.goToMainPage,this.addEtape),t=this.deleteCursus,c=this.resetCurrentItem,u=this.saveEtape,d="FUNNEL";return n.children.forEach(function(e,t){d+="_"+e.metadata.page.id}),m.a.createElement("div",{className:"we-pt-2"},m.a.createElement("hr",null),m.a.createElement(R,{type:this.state.EtapeToDelete&&void 0!==this.state.EtapeToDelete.Etape.metadata?"Etape":"cours",showModal:this.state.displayConfirmationModal,confirmModal:t,hideModal:function(){e.setState({displayConfirmationModal:!1})},message:"Delete Message"}),m.a.createElement("div",{className:"we-row"},m.a.createElement(S,{funnelId:this.props.match.params.menu_id,funnelHash:d,siteId:this.props.currentSiteInEdit.id})),0<a.metadata.id&&m.a.createElement("div",{className:"we-row"},m.a.createElement("span",{className:"we-h5 we-text-white"},m.a.createElement("i",{className:"fas fa-arrow-left ",onClick:function(){c()}}," ")," "," Retour au funnel"),m.a.createElement("div",{className:"we-col-md-12"},m.a.createElement("div",{className:"we-card we-my-3 we-text-white"},m.a.createElement("div",{className:"we-card-body"},m.a.createElement("div",{className:"card-column-header"},m.a.createElement("div",{className:"we-row"},m.a.createElement("div",{className:"we-col-12"},m.a.createElement(h.c,{initialValues:{title:a.metadata.title},validationSchema:g.b().shape({title:g.c().min(3,"Trop court!").max(500,"Trop long!").required("Obligatoire")}),onSubmit:function(){var s,t=(s=regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:u(P({},a,{metadata:P({},a.metadata,t)}));case 1:case"end":return e.stop()}},e)}),function(){var e=this,o=arguments;return new Promise(function(t,a){var n=s.apply(e,o);function r(e){N(n,t,a,r,i,"next",e)}function i(e){N(n,t,a,r,i,"throw",e)}r(void 0)})});return function(e){return t.apply(this,arguments)}}()},function(e){var t=e.errors,e=e.touched;return m.a.createElement(h.b,null,m.a.createElement(f.FormGroup,null,m.a.createElement(f.Col,{md:"12"},m.a.createElement(f.FormLabel,{htmlFor:"title"},"Titre"),m.a.createElement(h.a,{name:"title",type:"text",placeholder:"Titre",className:"we-form-control",invalid:t.title&&e.title}))),m.a.createElement("span",null,m.a.createElement("small",null,t.title)),m.a.createElement("br",null),m.a.createElement(f.FormGroup,null,m.a.createElement(f.Col,{md:"12"},m.a.createElement(f.Button,{color:"primary",type:"submit",className:"we-btn-block"},"enregistrer"))))})))))))),0===a.metadata.id&&m.a.createElement("div",null,n.children.length<10&&m.a.createElement(f.Button,{className:"we-btn-block",onClick:function(){return l()}},this.state.isLoading&&m.a.createElement("i",{className:"fa fa-spinner fa-spin"}),!this.state.isLoading&&m.a.createElement("span",null,m.a.createElement("i",{className:"fas fa-plus"})," Ajouter une page")),10<=n.children.length&&m.a.createElement(f.Button,{className:"we-btn-block we-disabled"},this.state.isLoading&&m.a.createElement("i",{className:"fa fa-spinner fa-spin"}),!this.state.isLoading&&m.a.createElement("span",null,m.a.createElement("i",{className:"fas fa-plus"})," Ajouter une page")),m.a.createElement(p.Container,{orientation:"vertical",onDrop:this.onColumnDrop,dragHandleSelector:".column-drag-handle"},n.children.map(function(e,t){return m.a.createElement(p.Draggable,{key:t},m.a.createElement("div",{className:"we-row we-py-0"},m.a.createElement("div",{className:"we-col-md-12 we-py-0 we-mb-0 we-mt-0"},m.a.createElement("div",{className:"we-card we-my-3 we-text-white"},m.a.createElement("div",{className:"we-card-body"},m.a.createElement("div",{className:e.props.className},m.a.createElement("div",{className:"card-column-header"},m.a.createElement("div",{className:"we-row"},m.a.createElement("div",{className:"we-col-12"},e.metadata.id!==a.metadata.id&&m.a.createElement("div",{style:{display:"inlineBlock"}},m.a.createElement("h6",{className:"we-card-title"},0===a.metadata.id&&m.a.createElement("span",{className:"column-drag-handle",style:{cursor:"grab"}},m.a.createElement("i",{className:"fal fa-arrows-alt"}))," ",m.a.createElement("span",{style:{color:e.metadata.page.id===r?"#6666ff":"white"}}," ",e.metadata.title),m.a.createElement("div",{className:"we-text-end"},m.a.createElement(f.Button,{variant:"secondary",onClick:function(){return o(e)},title:"éditer le Etape",className:"we-btn we-btn-sm "},m.a.createElement("i",{className:"fal fa-pencil-alt"})),m.a.createElement(f.Button,{variant:"secondary",onClick:function(){return s(e)},title:"Modifier le contenu de la page",className:"we-btn we-btn-sm "},m.a.createElement("i",{className:"fal fa-file-alt"})),e.metadata.page.id===r?m.a.createElement(f.Button,{variant:"secondary",className:"we-btn we-btn-sm we-disabled"},m.a.createElement("i",{className:"fal fa-trash-alt"})):m.a.createElement(f.Button,{variant:"secondary",onClick:function(){return i(e,t)},className:"we-btn we-btn-sm "},m.a.createElement("i",{className:"fal fa-trash-alt"}))))),e.metadata.id===a.metadata.id&&m.a.createElement("div",null)),m.a.createElement("div",{className:"we-col-3 we-text-right we-mt-0 we-mb-1"}))))))),t<n.children.length-1&&m.a.createElement("div",{style:{textAlign:"center",color:"white"}},m.a.createElement("i",{className:"fas fa-arrow-down"}))))}))))}}])&&k(e.prototype,t),a&&k(e,a),r}();t.default=Object(r.connect)(function(e){return{sections:Object(i.F)(e),currentPageInEdit:Object(i.e)(e),currentProductInEdit:Object(i.g)(e),currentSiteInEdit:Object(i.i)(e)}},function(t){return{resetSommaire:function(e){t({type:l.rd,id:e})}}})(a)}}]);