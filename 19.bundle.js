(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{635:function(e,t,a){"use strict";a.r(t);var n=a(0),C=a.n(n),S=a(6),E=a(586),c=a(2),o=a(4),n=a(11);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function s(a){var n=m();return function(){var e,t=f(a);return e=n?(e=f(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==r(e)&&"function"!=typeof e?u(t):e}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){var a="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(e))return a.get(e);a.set(e,t)}function t(){return d(e,arguments,f(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),p(t,e)}(e)}function d(e,t,a){return(d=m()?Reflect.construct:function(e,t,a){var n=[null];n.push.apply(n,t);n=new(Function.bind.apply(e,n));return a&&p(n,a.prototype),n}).apply(null,arguments)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function w(u){return{apiFormationsSlugCursusitemOrderPut:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(null==e)throw new b("rankItem","Required parameter rankItem was null or undefined when calling apiFormationsSlugCursusitemOrderPut.");if(null==t)throw new b("slug","Required parameter slug was null or undefined when calling apiFormationsSlugCursusitemOrderPut.");var n="/api/formations/{slug}/cursusitem/order".replace("{".concat("slug","}"),encodeURIComponent(String(t))),r=c.parse(n,!0),i=Object.assign({method:"PUT"},a),t={};u&&u.apiKey&&(n="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,t.Authorization=n),t["Content-Type"]="application/json",r.query=Object.assign({},r.query,{},a.query),delete r.search,i.headers=Object.assign({},t,a.headers);return i.body=JSON.stringify(e||{}),{url:c.format(r),options:i}},apiFormationsSlugCursusitemsCursusDelete:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(null==e)throw new b("slug","Required parameter slug was null or undefined when calling apiFormationsSlugCursusitemsCursusDelete.");if(null==t)throw new b("cursus","Required parameter cursus was null or undefined when calling apiFormationsSlugCursusitemsCursusDelete.");var n="/api/formations/{slug}/cursusitems/{cursus}".replace("{".concat("slug","}"),encodeURIComponent(String(e))).replace("{".concat("cursus","}"),encodeURIComponent(String(t))),r=c.parse(n,!0),e=Object.assign({method:"DELETE"},a),t={};return u&&u.apiKey&&(n="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,t.Authorization=n),r.query=Object.assign({},r.query,{},a.query),delete r.search,e.headers=Object.assign({},t,a.headers),{url:c.format(r),options:e}},apiFormationsSlugCursusitemsCursusGet:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(null==e)throw new b("slug","Required parameter slug was null or undefined when calling apiFormationsSlugCursusitemsCursusGet.");if(null==t)throw new b("cursus","Required parameter cursus was null or undefined when calling apiFormationsSlugCursusitemsCursusGet.");var n="/api/formations/{slug}/cursusitems/{cursus}".replace("{".concat("slug","}"),encodeURIComponent(String(e))).replace("{".concat("cursus","}"),encodeURIComponent(String(t))),r=c.parse(n,!0),e=Object.assign({method:"GET"},a),t={};return u&&u.apiKey&&(n="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,t.Authorization=n),r.query=Object.assign({},r.query,{},a.query),delete r.search,e.headers=Object.assign({},t,a.headers),{url:c.format(r),options:e}},apiFormationsSlugCursusitemsCursusPatchPut:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(null==e)throw new b("cursusItem","Required parameter cursusItem was null or undefined when calling apiFormationsSlugCursusitemsCursusPatchPut.");if(null==t)throw new b("slug","Required parameter slug was null or undefined when calling apiFormationsSlugCursusitemsCursusPatchPut.");if(null==a)throw new b("cursus","Required parameter cursus was null or undefined when calling apiFormationsSlugCursusitemsCursusPatchPut.");var r="/api/formations/{slug}/cursusitems/{cursus}/patch".replace("{".concat("slug","}"),encodeURIComponent(String(t))).replace("{".concat("cursus","}"),encodeURIComponent(String(a))),i=c.parse(r,!0),t=Object.assign({method:"PUT"},n),a={};u&&u.apiKey&&(r="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,a.Authorization=r),a["Content-Type"]="application/json",i.query=Object.assign({},i.query,{},n.query),delete i.search,t.headers=Object.assign({},a,n.headers);return t.body=JSON.stringify(e||{}),{url:c.format(i),options:t}},apiFormationsSlugCursusitemsCursusPut:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(null==e)throw new b("cursusItem","Required parameter cursusItem was null or undefined when calling apiFormationsSlugCursusitemsCursusPut.");if(null==t)throw new b("slug","Required parameter slug was null or undefined when calling apiFormationsSlugCursusitemsCursusPut.");if(null==a)throw new b("cursus","Required parameter cursus was null or undefined when calling apiFormationsSlugCursusitemsCursusPut.");var r="/api/formations/{slug}/cursusitems/{cursus}".replace("{".concat("slug","}"),encodeURIComponent(String(t))).replace("{".concat("cursus","}"),encodeURIComponent(String(a))),i=c.parse(r,!0),t=Object.assign({method:"PUT"},n),a={};u&&u.apiKey&&(r="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,a.Authorization=r),a["Content-Type"]="application/json",i.query=Object.assign({},i.query,{},n.query),delete i.search,t.headers=Object.assign({},a,n.headers);return t.body=JSON.stringify(e||{}),{url:c.format(i),options:t}},apiFormationsSlugCursusitemsPost:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(null==e)throw new b("formationItem","Required parameter formationItem was null or undefined when calling apiFormationsSlugCursusitemsPost.");if(null==t)throw new b("slug","Required parameter slug was null or undefined when calling apiFormationsSlugCursusitemsPost.");var n="/api/formations/{slug}/cursusitems".replace("{".concat("slug","}"),encodeURIComponent(String(t))),r=c.parse(n,!0),i=Object.assign({method:"POST"},a),t={};u&&u.apiKey&&(n="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,t.Authorization=n),t["Content-Type"]="application/json",r.query=Object.assign({},r.query,{},a.query),delete r.search,i.headers=Object.assign({},t,a.headers);return i.body=JSON.stringify(e||{}),{url:c.format(r),options:i}},publicFormationsSlugCursusitemsGet:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(null==e)throw new b("slug","Required parameter slug was null or undefined when calling publicFormationsSlugCursusitemsGet.");var r="/public/formations/{slug}/cursusitems".replace("{".concat("slug","}"),encodeURIComponent(String(e))),i=c.parse(r,!0),o=Object.assign({method:"GET"},n),s={},e={};return u&&u.apiKey&&(r="function"==typeof u.apiKey?u.apiKey("Authorization"):u.apiKey,s.Authorization=r),void 0!==t&&(e.page=t),void 0!==a&&(e.term=a),i.query=Object.assign({},i.query,e,n.query),delete i.search,o.headers=Object.assign({},s,n.headers),{url:c.format(i),options:o}}}}function y(i){return{apiFormationsSlugCursusitemOrderPut:function(e,t,a){var n=w(i).apiFormationsSlugCursusitemOrderPut(e,t,a);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+n.url,n.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}},apiFormationsSlugCursusitemsCursusDelete:function(e,t,a){var n=w(i).apiFormationsSlugCursusitemsCursusDelete(e,t,a);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+n.url,n.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}},apiFormationsSlugCursusitemsCursusGet:function(e,t,a){var n=w(i).apiFormationsSlugCursusitemsCursusGet(e,t,a);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+n.url,n.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}},apiFormationsSlugCursusitemsCursusPatchPut:function(e,t,a,n){var r=w(i).apiFormationsSlugCursusitemsCursusPatchPut(e,t,a,n);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+r.url,r.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}},apiFormationsSlugCursusitemsCursusPut:function(e,t,a,n){var r=w(i).apiFormationsSlugCursusitemsCursusPut(e,t,a,n);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+r.url,r.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}},apiFormationsSlugCursusitemsPost:function(e,t,a){var n=w(i).apiFormationsSlugCursusitemsPost(e,t,a);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+n.url,n.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}},publicFormationsSlugCursusitemsGet:function(e,t,a,n){var r=w(i).publicFormationsSlugCursusitemsGet(e,t,a,n);return function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:o)((1<arguments.length&&void 0!==arguments[1]?arguments[1]:v)+r.url,r.options).then(function(e){if(200<=e.status&&e.status<300)return e.json();throw e})}}}}var v=Object(n.g)("https://awbjanv94g.execute-api.eu-west-1.amazonaws.com/prod/formation").replace(/\/+$/,""),b=function(){i(n,l(Error));var a=s(n);function n(e,t){return h(this,n),g(u(t=a.call(this,t)),"name",void 0),t}return n}();var P=a(52),n=a(9),_=a(613),O=a(612),I=a(8);function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t,a,n,r,i,o){try{var s=e[i](o),u=s.value}catch(e){return void a(e)}s.done?t(u):Promise.resolve(u).then(n,r)}function N(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(a);(n="function"==typeof Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})):n).forEach(function(e){L(t,e,a[e])})}return t}function T(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(a){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=M(a);return e=n?(e=M(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==A(e)&&"function"!=typeof e?R(t):e}}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function q(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?k(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function x(e){var t=e.showModal,a=e.hideModal,n=e.confirmModal,r=e.id,i=e.type;return e.message,C.a.createElement(S.Modal,{centered:!0,dialogClassName:" small-modal-w we-m-auto",show:t,onHide:a},C.a.createElement(S.Modal.Header,{closeButton:!0},C.a.createElement(S.Modal.Title,null," Attention !")),C.a.createElement(S.Modal.Body,null,C.a.createElement("div",{className:"we-container we-pt-4"},"Voulez-vous vraiment supprimer ce ",i,"?")),C.a.createElement(S.Modal.Footer,null,C.a.createElement(S.Button,{variant:"secondary",onClick:a,size:"sm"},"Annuler"),C.a.createElement(S.Button,{variant:"danger",size:"sm",onClick:function(){return n(i,r)}},"Supprimer")))}function K(e,t){var a=t.removedIndex,n=t.addedIndex,t=t.payload;return null===a&&null===n||(e=q(e),null!==a&&(t=e.splice(a,1)[0]),null!==n&&e.splice(n,0,t)),e}function B(){var e=Math.floor(10*Math.random());return U[e]}var z={headers:{Accept:"application/json","Content-Type":"application/json",Authorization:localStorage.getItem("currentUser")?"Bearer "+localStorage.getItem("currentUser"):""}},U=["azure","beige","bisque","blanchedalmond","burlywood","cornsilk","gainsboro","ghostwhite","ivory","khaki"],a=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(r,C.a.Component);var e,t,a,n=D(r);function r(){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),L(R(s=n.call(this)),"generateItems",function(e,t){var a=[],n=s.state.totalPages,r=0;return Array.isArray(e)&&e.forEach(function(e){e.is_cours&&n++,a.push(t(r,e)),r++}),0<n&&s.setState({totalPages:n}),a}),L(R(s),"compareOrdre",function(e,t){return e.metadata.ordre<t.metadata.ordre?-1:e.metadata.ordre>t.metadata.ordre?1:0}),L(R(s),"buildTreeview",function(e){var t=e.find(function(e){return 0==e.is_cours&&0==e.is_chapitre}),e=t.id,t={type:"container",props:{orientation:"vertical"},children:s.generateItems(t.children,function(e,t){return{id:t.id,type:"container",metadata:t,props:{orientation:"vertical",className:"we-card-container"},children:s.generateItems(t.children,function(e,t){return{type:"draggable",id:t.id,metadata:t,props:{className:"we-card ",style:{backgroundColor:B()}}}}).sort(s.compareOrdre)}}).sort(s.compareOrdre)};s.setState({scene:N({},t),treeRootId:e,isLoading:!1})}),L(R(s),"onColumnDrop",function(e){var t=N({},s.state.scene);t.children=K(t.children,e);var a=[],n=0;t.children.forEach(function(e){a.push({id:e.id,rank:n}),n++}),s.saveOrder(a,function(){s.setState({scene:t,isLoading:!1}),s.refreshSommaire()})}),L(R(s),"onCardDrop",function(t,e){var a,n,r,i,o;null===e.removedIndex&&null===e.addedIndex||(o=(a=N({},s.state.scene)).children.filter(function(e){return e.id===t})[0],n=a.children.indexOf(o),(o=Object.assign({},o)).children=K(o.children,e),a.children.splice(n,1,o),r=[],i=0,o.children.forEach(function(e){r.push({id:e.id,rank:i}),i++}),o={title:s.state.currentPayload.metadata.title,isFree:s.state.currentPayload.metadata.isFree,parent:t},s.setState({isLoading:!0}),y().apiFormationsSlugCursusitemsCursusPatchPut(o,window.__METADATA.product_props.formationId,s.state.currentPayload.metadata.id,z).call().then(function(e){s.saveOrder(r,function(){s.setState({scene:N({},a),isLoading:!1}),s.refreshSommaire()})}))}),L(R(s),"resetCurrentItem",function(){s.setState({currentItemInEdit:{metadata:{id:0}}})}),L(R(s),"edit",function(e){e==s.state.currentItemInEdit?s.resetCurrentItem():s.setState({currentItemInEdit:e})}),L(R(s),"setVisibility",function(n){var e;s.state.isLoading||(e={visible:!n.metadata.visible},s.setState({isLoading:!0}),y().apiFormationsSlugCursusitemsCursusPatchPut(e,window.__METADATA.product_props.formationId,n.metadata.id,z).call().then(function(t){var a,e;n.metadata.is_cours?(a=Object.assign({},s.state.scene)).children.forEach(function(e){e=e.children.find(function(e){return e.metadata.id===n.metadata.id});e&&(e.metadata.visible=t.visible,s.setState({isLoading:!1,scene:a}),s.refreshSommaire())}):((e=Object.assign({},s.state.scene)).children.find(function(e){return e.metadata.id===n.metadata.id}).metadata.visible=t.visible,s.setState({isLoading:!1,scene:e}),s.refreshSommaire())}))}),L(R(s),"addChapitre",function(){var e;s.state.isLoading||(e={title:"Mon Nouveau chapitre",isCours:!1,isChapitre:!0,isFree:!1,pageId:0,duration:0,visible:!0,ordre:1e3,parent:s.state.treeRootId.toString()},s.setState({isLoading:!0}),y().apiFormationsSlugCursusitemsPost(e,window.__METADATA.product_props.formationId,z).call().then(function(e){var t={id:e.id,type:"we-container",metadata:e,props:{orientation:"vertical",className:"we-card-container"},children:[]},e=Object.assign({},s.state.scene);e.children.unshift(t);s.setState({isLoading:!1,scene:e}),s.refreshSommaire()}))}),L(R(s),"deleteChapitre",function(){var e=s.state.chapitreToDelete,t=e.chapitre,a=e.index;y().apiFormationsSlugCursusitemsCursusDelete(window.__METADATA.product_props.formationId,t.metadata.id,z).call().then(function(e){var t=Object.assign({},s.state.scene);t.children.splice(a,1),s.setState({isLoading:!1,scene:t,displayConfirmationModal:!1}),s.refreshSommaire()})}),L(R(s),"deleteIntent",function(e,t,a){s.setState({itemToDelete:{item:e,chapitre:t,index:a},displayConfirmationModal:!0},function(){})}),L(R(s),"deleteChapitreIntent",function(e,t){s.setState({chapitreToDelete:{chapitre:e,index:t},displayConfirmationModal:!0},function(){})}),L(R(s),"goToMainPage",function(){location.href="/editor/pages/formation/"+window.__METADATA.product_props.id}),L(R(s),"goToPage",function(e){e.metadata.page_id<3?s.fixCours(e):location.href="/editor/pages/cursus/"+e.metadata.page_id}),L(R(s),"createCursusPage",function(e){return{nom:e.title,url:" formations/"+window.__METADATA.product_props.id+"/cursus/"+e.id,editor:"10",is_home:!1,is_error:!1,module:"5",module_resource:window.__METADATA.product_props.id,module_page_type:"cursus",is_service:!1}}),L(R(s),"fixCours",function(n){var e,t;s.state.isLoading||(s.setState({isLoading:!0}),e=s.props.currentSiteInEdit.id,t=s.createCursusPage(n.metadata),Object(P.h)().apiSitesSitePagesPost(t,e.toString(),z).call().then(function(a){var e={title:n.metadata.title,pageId:a.id};y().apiFormationsSlugCursusitemsCursusPatchPut(e,window.__METADATA.product_props.formationId,n.metadata.id.toString(),z).call().then(function(e){e=N({},e);e.page_id=a.id;e.id,B();var t=Object.assign({},s.state.scene);t.children.forEach(function(e){e=e.children.find(function(e){return e.metadata.id===n.metadata.id});e&&(e.metadata.page_id=a.id,s.setState({isLoading:!1,scene:N({},t)},function(){s.resetCurrentItem(),s.refreshSommaire()}))})})}))}),L(R(s),"addCours",function(o){var e;s.state.isLoading||(e={title:"Mon Nouveau cours "+(s.state.totalPages+1),isCours:!0,isChapitre:!1,isFree:!1,pageId:0,duration:0,visible:!1,ordre:1e3,parent:o.metadata.id},s.setState({isLoading:!0}),y().apiFormationsSlugCursusitemsPost(e,window.__METADATA.product_props.formationId,z).call().then(function(i){var e=s.props.currentSiteInEdit.id,t=s.createCursusPage(i);Object(P.h)().apiSitesSitePagesPost(t,e.toString(),z).call().then(function(r){var e={title:i.title,pageId:r.id};y().apiFormationsSlugCursusitemsCursusPatchPut(e,window.__METADATA.product_props.formationId,i.id.toString(),z).call().then(function(e){var t=N({},i);t.page_id=r.id;var a={type:"draggable",id:i.id,metadata:t,props:{className:"we-card",style:{backgroundColor:B()}},data:"test"},n=Object.assign({},s.state.scene),t=n.children.filter(function(e){return e.id===o.id})[0];Object.assign({},t).children.push(a),s.setState({totalPages:s.state.totalPages+1,scene:n,isLoading:!1}),s.refreshSommaire()})})}))}),L(R(s),"dragStart",function(e){s.setState({isLoading:!0,currentPayload:e.payload})}),L(R(s),"dragEnd",function(e){}),L(R(s),"saveOrder",function(e,t){y().apiFormationsSlugCursusitemOrderPut(e,window.__METADATA.product_props.formationId,z).call().then(function(e){t()})}),L(R(s),"saveCours",function(n,e,t){var a;s.state.isLoading||(a={title:n.metadata.title,duration:n.metadata.duration,visible:n.metadata.visible,isCours:!0},s.setState({isLoading:!0}),y().apiFormationsSlugCursusitemsCursusPatchPut(a,window.__METADATA.product_props.formationId,n.metadata.id,z).call().then(function(t){var a=Object.assign({},s.state.scene);a.children.forEach(function(e){e=e.children.find(function(e){return e.metadata.id===n.metadata.id});e&&(e.metadata=t,s.setState({isLoading:!1,scene:a},function(){s.refreshSommaire(),s.resetCurrentItem()}))})}))}),L(R(s),"saveChapitre",function(n){var e;s.state.isLoading||(e={title:n.metadata.title,duration:n.metadata.duration,visible:n.metadata.visible,isChapitre:n.metadata.isChapitre},s.setState({isLoading:!0}),y().apiFormationsSlugCursusitemsCursusPatchPut(e,window.__METADATA.product_props.formationId,n.metadata.id,z).call().then(function(e){var t=Object.assign({},s.state.scene),a=t.children.map(function(e){return e.id===n.id?n:e});s.setState({scene:{scene:t,children:a},forcedReloadCount:s.state.forcedReloadCount+1},function(){s.setState({isLoading:!1,currentItemInEdit:{metadata:{id:0}}}),s.refreshSommaire()})}))}),L(R(s),"hasDraft",function(){}),L(R(s),"getCardPayload",function(t){return function(e){return s.state.scene.children.filter(function(e){return e.id===t})[0].children[e]}}),s.state={isCursusLoaded:!1,currentItemInEdit:{metadata:{id:0}},currentPayload:{},itemToDelete:{item:{},chapitre:{},index:0},chapitreToDelete:{chapitre:{},index:0},treeRootId:0,productId:0,isLoading:!1,totalPages:0,maxPages:100,formationId:"0",produit:{titre:""},cursusTree:[],displayConfirmationModal:!1,forcedReloadCount:0,sectionSommaireId:0,scene:{type:"container",props:{orientation:"vertical"},children:[]}},s.dragStart=s.dragStart.bind(R(s)),s.deleteCursus=s.deleteCursus.bind(R(s)),s}return e=r,(t=[{key:"refreshSommaire",value:function(){0<this.state.sectionSommaireId&&this.props.resetSommaire(this.state.sectionSommaireId)}},{key:"componentDidUpdate",value:function(){var t=this;this.state.isCursusLoaded||window.__METADATA&&window.__METADATA.product_props&&(this.state.isLoading||(this.setState({isLoading:!0}),y().publicFormationsSlugCursusitemsGet(window.__METADATA.product_props.formationId,1,z).call().then(function(e){t.setState({isCursusLoaded:!0}),e.items&&1==e.items.length&&(t.setState({isLoading:!1}),t.buildTreeview(e.items)),"formation"!==t.props.currentPageInEdit.module_page_type||(e=t.props.sections.find(function(e){return"PageFormationRcpt"===e.content.componentName}))&&t.setState({sectionSommaireId:e.id})})))}},{key:"componentDidMount",value:function(){var t=this;this.state.isCursusLoaded||window.__METADATA&&window.__METADATA.product_props&&y().publicFormationsSlugCursusitemsGet(window.__METADATA.product_props.formationId,1,z).call().then(function(e){t.setState({isCursusLoaded:!0}),e.items&&1==e.items.length&&(t.buildTreeview(e.items),"formation"!==t.props.currentPageInEdit.module_page_type||(e=t.props.sections.find(function(e){return"PageFormationRcpt"===e.content.componentName}))&&t.setState({sectionSommaireId:e.id}))})}},{key:"deleteCursus",value:function(){var e,t,a,n,r,i=this;this.state.isLoading||(this.setState({isLoading:!0}),this.state.chapitreToDelete&&void 0!==this.state.chapitreToDelete.chapitre.metadata?this.deleteChapitre():(t=(e=this.state.itemToDelete).item,a=e.chapitre,n=e.index,r=0<t.metadata.page_id?t.metadata.page_id:t.metadata.pageId,y().apiFormationsSlugCursusitemsCursusDelete(window.__METADATA.product_props.formationId,t.metadata.id,z).call().then(function(e){var t;r?Object(P.f)().apiPagesPageDelete(r,z).call().then(function(e){var t=Object.assign({},i.state.scene);t.children.filter(function(e){return e.id===a.id})[0].children.splice(n,1),i.setState({totalPages:i.state.totalPages-1,scene:t,isLoading:!1,displayConfirmationModal:!1}),i.refreshSommaire()}).catch(function(e){}):(console.error("No Page Founded"),(t=Object.assign({},i.state.scene)).children.filter(function(e){return e.id===a.id})[0].children.splice(n,1),i.setState({totalPages:i.state.totalPages-1,scene:t,isLoading:!1,displayConfirmationModal:!1}),i.refreshSommaire())})))}},{key:"render",value:function(){var e=this,t=this.state,n=t.currentItemInEdit,r=t.totalPages,i=t.maxPages,a=t.scene,o=this.props.currentPageInEdit&&this.props.currentPageInEdit.id,s=this.dragStart,u=this.dragEnd,c=this.onCardDrop,l=(this.onColumnDrop,this.setVisibility),d=(this.deleteChapitre,this.deleteChapitreIntent),m=this.deleteIntent,p=this.getCardPayload,f=this.edit,h=this.goToPage,g=(this.goToMainPage,this.addCours),w=this.addChapitre,t=this.deleteCursus,y=this.resetCurrentItem,v=this.saveChapitre,b=this.saveCours;return C.a.createElement("div",{className:"we-pt-2"},C.a.createElement("hr",null),C.a.createElement(x,{type:this.state.chapitreToDelete&&void 0!==this.state.chapitreToDelete.chapitre.metadata?"chapitre":"cours",showModal:this.state.displayConfirmationModal,confirmModal:t,hideModal:function(){e.setState({displayConfirmationModal:!1})},message:"Delete Message"}),0<n.metadata.id&&C.a.createElement("div",{className:"we-row"},C.a.createElement("span",{className:"we-h5 we-text-white"},C.a.createElement("i",{className:"fas fa-arrow-left ",onClick:function(){y()}}," ")," "," Retour au cursus"),C.a.createElement("div",{className:"we-col-md-12"},C.a.createElement("div",{className:"we-card we-my-3 we-text-white"},C.a.createElement("div",{className:"we-card-body"},C.a.createElement("div",{className:"card-column-header"},C.a.createElement("div",{className:"we-row"},C.a.createElement("div",{className:"we-col-12"},C.a.createElement(_.c,{initialValues:{title:n.metadata.title,duration:n.metadata.duration},validationSchema:O.b().shape({title:O.c().min(3,"Trop court!").max(500,"Trop long!").required("Obligatoire"),duration:O.a().required("Obligatoire").integer("Vous devez renseigner un nombre")}),onSubmit:function(){var s,t=(s=regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(n.metadata.is_cours?b:v)(N({},n,{metadata:N({},n.metadata,t)}));case 1:case"end":return e.stop()}},e)}),function(){var e=this,o=arguments;return new Promise(function(t,a){var n=s.apply(e,o);function r(e){j(n,t,a,r,i,"next",e)}function i(e){j(n,t,a,r,i,"throw",e)}r(void 0)})});return function(e){return t.apply(this,arguments)}}()},function(e){var t=e.errors,e=e.touched;return C.a.createElement(_.b,null,C.a.createElement(S.FormGroup,null,C.a.createElement(S.Col,{md:"12"},C.a.createElement(S.FormLabel,{htmlFor:"title"},"Titre"),C.a.createElement(_.a,{name:"title",type:"text",placeholder:"Titre",className:"we-form-control",invalid:t.title&&e.title}))),C.a.createElement("span",null,C.a.createElement("small",null,t.title)),n.metadata.is_cours&&C.a.createElement(S.FormGroup,null,C.a.createElement("br",null),C.a.createElement(S.FormLabel,{htmlFor:"title"},"Durée en min"),C.a.createElement(_.a,{name:"duration",type:"number",placeholder:"90",className:"we-form-control",invalid:t.duration&&e.duration}),t.duration),C.a.createElement("br",null),C.a.createElement(S.FormGroup,null,C.a.createElement(S.Col,{md:"12"},C.a.createElement(S.Button,{color:"primary",type:"submit",className:"we-btn-block"},"enregistrer"))))})))))))),0===n.metadata.id&&C.a.createElement("div",null,C.a.createElement(S.Button,{className:"we-btn-block",onClick:function(){return w()}},this.state.isLoading&&C.a.createElement("i",{className:"fa fa-spinner fa-spin"}),!this.state.isLoading&&C.a.createElement("span",null,C.a.createElement("i",{className:"fas fa-plus"})," Ajouter un chapitre")),C.a.createElement(E.Container,{orientation:"vertical",onDrop:this.onColumnDrop,dragHandleSelector:".column-drag-handle"},a.children.map(function(a,e){return C.a.createElement(E.Draggable,{key:e},C.a.createElement("div",{className:"we-row"},C.a.createElement("div",{className:"we-col-md-12"},C.a.createElement("div",{className:"we-card we-my-3 we-text-white"},C.a.createElement("div",{className:"we-card-body"},C.a.createElement("div",{className:a.props.className},C.a.createElement("div",{className:"card-column-header"},C.a.createElement("div",{className:"we-row"},C.a.createElement("div",{className:"we-col-12"},a.metadata.id!==n.metadata.id&&C.a.createElement("div",{style:{display:"inlineBlock"}},C.a.createElement("h6",{className:"we-card-title"},0===n.metadata.id&&C.a.createElement("span",{className:"column-drag-handle",style:{cursor:"grab"}},C.a.createElement("i",{className:"fal fa-arrows-alt"}))," ",a.metadata.title,C.a.createElement("div",{className:"we-text-end"},C.a.createElement(S.Button,{variant:"secondary",onClick:function(){return f(a)},title:"éditer le chapitre",className:"we-btn we-btn-sm "},C.a.createElement("i",{className:"fal fa-pencil-alt"})),C.a.createElement(S.Button,{variant:"secondary",onClick:function(){return l(a)},title:"visibilité du chapitre",className:"we-btn we-btn-sm "},a.metadata.visible&&C.a.createElement("i",{className:"fal fa-eye"}),!a.metadata.visible&&C.a.createElement("i",{className:"far fa-eye-slash"})),0===a.children.length&&C.a.createElement(S.Button,{variant:"secondary",onClick:function(){return d(a,e)},className:"we-btn we-btn-sm "},C.a.createElement("i",{className:"fal fa-trash-alt"}))))),a.metadata.id===n.metadata.id&&C.a.createElement("div",null)),C.a.createElement("div",{className:"we-col-3 we-text-right we-mt-0 we-mb-1"}))),C.a.createElement(E.Container,{groupName:"col",onDrop:function(e){return c(a.id,e)},getChildPayload:p(a.id),dragClass:"card-ghost",dropClass:"card-ghost-drop",onDragStart:function(e){return s(e)},dragHandleSelector:".cours-drag-handle",onDragEnd:function(e){return u(e)}},a.children.map(function(e,t){return C.a.createElement(E.Draggable,{key:t},C.a.createElement("div",{className:e.props.className},C.a.createElement("div",{className:"we-row"},C.a.createElement("div",{className:"we-col-12"},C.a.createElement("div",{className:"we-row"},C.a.createElement("div",{className:"we-m-0 we-px-4"}),e.metadata.id!==n.metadata.id&&C.a.createElement("div",{className:"we-col-12 we-px-4"},C.a.createElement("h6",{className:"we-card-title",style:{color:e.metadata.page_id===o?"#5757d9":"white"}},0===n.metadata.id&&C.a.createElement("span",{className:"cours-drag-handle",style:{cursor:"grab"}},C.a.createElement("i",{className:"fal fa-arrows-alt"}))," ",e.metadata.title),C.a.createElement("i",{className:"far fa-clock"})," "," ",e.metadata.duration,C.a.createElement("small",null," mn"),C.a.createElement("br",null)),e.metadata.id===n.metadata.id&&C.a.createElement("div",{className:"we-col-11"})),e.metadata.id!==n.metadata.id&&C.a.createElement("div",{className:"we-text-end"},C.a.createElement(S.Button,{variant:"secondary",onClick:function(){return f(e)},title:"éditer le titre et la durée du cours",className:"we-btn we-btn-sm "},C.a.createElement("i",{className:"fal fa-pencil-alt"})),C.a.createElement(S.Button,{variant:"secondary",onClick:function(){return h(e)},title:"modifier le contenu du cours",className:"we-btn we-btn-sm "},C.a.createElement("i",{className:"fal fa-file-alt"})),C.a.createElement(S.Button,{variant:"secondary",title:"permuter la visibilité du cours",onClick:function(){return l(e)},className:"we-btn we-btn-sm "},e.metadata.visible&&C.a.createElement("i",{className:"fal fa-eye"}),!e.metadata.visible&&C.a.createElement("i",{className:"far fa-eye-slash"})),C.a.createElement(S.Button,{variant:"secondary",title:"supprimer le cours",onClick:function(){return m(e,a,t)},className:"we-btn we-btn-sm "},C.a.createElement("i",{className:"fal fa-trash-alt"})),C.a.createElement("hr",null))),C.a.createElement("div",{className:"we-col-2 we-text-right we-mt-0 we-mb-1"}))))}),C.a.createElement("div",{className:"we-row "},r<i&&C.a.createElement("div",{className:"we-col-12"},C.a.createElement(S.Button,{onClick:function(){return g(a)},className:"we-btn we-btn-sm"}," ","+ Ajouter une leçon"," ")),i<=r&&C.a.createElement("div",{className:"we-col-12"},C.a.createElement(S.Button,{className:"we-btn-sm we-disabled"}," ","+ Ajouter une leçon"," "))))))))))}))))}}])&&T(e.prototype,t),a&&T(e,a),r}();t.default=Object(n.connect)(function(e){return{sections:Object(I.D)(e),currentPageInEdit:Object(I.e)(e),currentProductInEdit:Object(I.g)(e),currentSiteInEdit:Object(I.i)(e)}},function(t){return{resetSommaire:function(e){t({type:"SECTION_FORCE_REFRESH_BY_ID",id:e})}}})(a)}}]);